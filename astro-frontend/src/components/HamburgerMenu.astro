---
// Hamburger Menu Component - Settings dropdown with theme toggle and navigation
---

<div class="hamburger-menu-wrapper">
  <!-- Hamburger Menu Button -->
  <button
    id="menu-toggle"
    class="header-btn hamburger-btn"
    aria-label="Toggle menu"
    aria-expanded="false"
  >
    <svg id="menu-icon" class="icon-large" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
    </svg>
    <svg id="close-icon" class="icon-large hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
  </button>

  <!-- Dropdown Menu -->
  <div id="menu-dropdown" class="menu-dropdown hidden">
    <div class="menu-content">
      <!-- Navigation Links -->
      <nav class="menu-nav">
        <a href="/" class="menu-link">
          <svg class="menu-link-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
          </svg>
          Home
        </a>
      </nav>

      <!-- Divider -->
      <hr class="menu-divider" />

      <!-- Theme Toggle Section -->
      <div class="menu-section">
        <p class="menu-section-title">Appearance</p>
        <div class="theme-toggle-row">
          <span class="theme-label">Dark Mode</span>
          <div class="theme-switch-wrapper">
            <svg id="sun-icon-inline" class="icon-small sun-icon" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
            <button
              id="theme-toggle"
              class="theme-toggle-switch"
              aria-label="Toggle dark mode"
              role="switch"
              aria-checked="false"
            >
              <span id="toggle-circle" class="toggle-circle"></span>
            </button>
            <svg id="moon-icon-inline" class="icon-small moon-icon" fill="currentColor" viewBox="0 0 24 24">
              <path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
          </div>
        </div>
      </div>

      <!-- Divider -->
      <hr class="menu-divider" />

      <!-- Language Selector -->
      <div class="menu-section">
        <p class="menu-section-title">Language</p>
        <div class="select-wrapper">
          <select id="language-select" class="menu-select">
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="fr">Français</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</div>

<style scoped>
  .hidden {
    display: none;
  }

  .hamburger-menu-wrapper {
    position: relative;
  }

  .header-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.375rem;
    color: var(--text-secondary);
    background-color: transparent;
    outline: none;
    border: none;
    border-radius: 0.25rem;
    cursor: pointer;
  }

  :global(.dark) .header-btn {
    color: var(--text-secondary-dark);
  }

  .icon-large {
    width: 1.75rem;
    height: 1.75rem;
  }

  .menu-dropdown {
    position: fixed;
    top: 3.5rem;
    left: 0;
    width: 280px;
    max-height: calc(100vh - 3.5rem);
    overflow-y: auto;
    background-color: var(--bg);
    border-right: 1px solid var(--border);
    z-index: 40;
  }

  :global(.dark) .menu-dropdown {
    background-color: var(--bg-dark);
    border-right-color: var(--border-dark);
  }

  .menu-dropdown.hidden {
    display: none;
  }

  .menu-content {
    padding: 1.5rem 1rem;
  }

  .menu-content > * + * {
    margin-top: 1rem;
  }

  .menu-nav {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .menu-link {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    border-radius: 0.25rem;
    color: var(--text);
    text-decoration: none;
    font-weight: 500;
  }

  :global(.dark) .menu-link {
    color: var(--text-dark);
  }

  .menu-link-icon {
    width: 1.25rem;
    height: 1.25rem;
    flex-shrink: 0;
  }

  .menu-divider {
    border: none;
    border-top: 1px solid var(--border);
    margin: 1rem 0;
  }

  :global(.dark) .menu-divider {
    border-top-color: var(--border-dark);
  }

  .menu-section {
    padding: 0 0.5rem;
  }

  .menu-section-title {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-tertiary);
    margin-bottom: 0.75rem;
  }

  :global(.dark) .menu-section-title {
    color: var(--text-tertiary-dark);
  }

  .theme-toggle-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.5rem 0;
  }

  .theme-label {
    font-size: 0.9rem;
    color: var(--text);
    font-weight: 500;
  }

  :global(.dark) .theme-label {
    color: var(--text-dark);
  }

  .theme-switch-wrapper {
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }

  .icon-small {
    width: 1rem;
    height: 1rem;
  }

  .sun-icon {
    color: var(--text-secondary);
  }

  :global(.dark) .sun-icon {
    color: var(--text-tertiary-dark);
  }

  .moon-icon {
    color: var(--text-tertiary);
  }

  :global(.dark) .moon-icon {
    color: var(--text-secondary-dark);
  }

  .theme-toggle-switch {
    cursor: pointer;
    position: relative;
    display: inline-flex;
    align-items: center;
    height: 1.5rem;
    width: 2.75rem;
    border-radius: 9999px;
    border: 1px solid var(--border);
    background-color: var(--bg-card);
    outline: none;
  }

  :global(.dark) .theme-toggle-switch {
    border-color: var(--border-dark);
    background-color: var(--bg-card-dark);
  }

  .toggle-circle {
    position: absolute;
    left: 0.125rem;
    display: inline-block;
    height: 1.125rem;
    width: 1.125rem;
    border-radius: 9999px;
    background-color: var(--text-secondary);
    transition: transform 0.2s ease;
  }

  :global(.dark) .toggle-circle {
    background-color: var(--text-dark);
    transform: translateX(1.25rem);
  }

  .select-wrapper {
    width: 100%;
  }

  .menu-select {
    width: 100%;
    padding: 0.625rem 0.75rem;
    border-radius: 0.25rem;
    border: 1px solid var(--border);
    background-color: var(--bg-card);
    color: var(--text);
    font-size: 0.875rem;
    outline: none;
    cursor: pointer;
  }

  :global(.dark) .menu-select {
    border-color: var(--border-dark);
    background-color: var(--bg-card-dark);
    color: var(--text-dark);
  }
</style>

<script>
  const STORAGE_KEY = 'color-scheme';
  const LANG_STORAGE_KEY = 'preferred-language';

  class HamburgerMenuManager {
    private menuToggle!: HTMLButtonElement;
    private menuDropdown!: HTMLElement;
    private themeToggle!: HTMLButtonElement;
    private menuIcon!: HTMLElement;
    private closeIcon!: HTMLElement;
    private toggleCircle!: HTMLElement;
    private languageSelect!: HTMLSelectElement;
    private isMenuOpen = false;

    constructor() {
      this.menuToggle = document.getElementById('menu-toggle') as HTMLButtonElement;
      this.menuDropdown = document.getElementById('menu-dropdown') as HTMLElement;
      this.themeToggle = document.getElementById('theme-toggle') as HTMLButtonElement;
      this.menuIcon = document.getElementById('menu-icon') as HTMLElement;
      this.closeIcon = document.getElementById('close-icon') as HTMLElement;
      this.toggleCircle = document.getElementById('toggle-circle') as HTMLElement;
      this.languageSelect = document.getElementById('language-select') as HTMLSelectElement;

      this.init();
    }

    private init() {
      // Menu toggle
      this.menuToggle.addEventListener('click', () => this.toggleMenu());

      // Theme toggle switch
      this.themeToggle.addEventListener('click', () => this.toggleTheme());

      // Language select
      if (this.languageSelect) {
        // Load saved language
        const savedLang = localStorage.getItem(LANG_STORAGE_KEY);
        if (savedLang) {
          this.languageSelect.value = savedLang;
        }
        
        this.languageSelect.addEventListener('change', (e) => {
          localStorage.setItem(LANG_STORAGE_KEY, (e.target as HTMLSelectElement).value);
        });
      }

      // Close menu on outside click
      document.addEventListener('click', (e) => {
        if (this.isMenuOpen && 
            !this.menuToggle.contains(e.target as Node) && 
            !this.menuDropdown.contains(e.target as Node)) {
          this.closeMenu();
        }
      });

      // Close on escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.isMenuOpen) {
          this.closeMenu();
        }
      });

      this.updateThemeUI();
    }

    private toggleMenu() {
      this.isMenuOpen ? this.closeMenu() : this.openMenu();
    }

    private openMenu() {
      this.isMenuOpen = true;
      this.menuDropdown.classList.remove('hidden');
      this.menuIcon.classList.add('hidden');
      this.closeIcon.classList.remove('hidden');
      this.menuToggle.setAttribute('aria-expanded', 'true');
    }

    private closeMenu() {
      this.isMenuOpen = false;
      this.menuDropdown.classList.add('hidden');
      this.menuIcon.classList.remove('hidden');
      this.closeIcon.classList.add('hidden');
      this.menuToggle.setAttribute('aria-expanded', 'false');
    }

    private toggleTheme() {
      const isDark = document.documentElement.classList.contains('dark');
      const newTheme = isDark ? 'light' : 'dark';
      this.setTheme(newTheme);
    }

    private setTheme(theme: string) {
      localStorage.setItem(STORAGE_KEY, theme);
      document.documentElement.classList.toggle('dark', theme === 'dark');
      this.updateThemeUI();
    }

    private updateThemeUI() {
      const isDark = document.documentElement.classList.contains('dark');
      this.themeToggle.setAttribute('aria-checked', isDark.toString());
    }
  }

  new HamburgerMenuManager();
</script>
