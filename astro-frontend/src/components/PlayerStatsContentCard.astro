---
/**
 * Player Stats Content Card
 *
 * Content card for the stats page when viewing a player entity.
 * Displays player statistics and related features in a tabbed interface.
 *
 * Tabs:
 * - Stats: Pizza chart + box score statistics
 * - Strengths: Strengths & weaknesses based on percentiles
 * - Similarity: Similar players based on embeddings
 */

import PlayerStatsTab from './tabs/PlayerStatsTab.astro';
import StrengthsWeaknessesTab from './tabs/StrengthsWeaknessesTab.astro';
import SimilarityTab from './tabs/SimilarityTab.astro';

interface Props {
  title?: string;
}

const { title = 'Statistics' } = Astro.props;
---

<div class="player-stats-content-card card" data-entity-type="player">
  <!-- Tab Navigation -->
  <div class="tabs-nav">
    <button class="tab-btn active" data-tab="player-stats">Stats</button>
    <button class="tab-btn" data-tab="player-strengths">Strengths</button>
    <button class="tab-btn" data-tab="player-similarity">Similarity</button>
  </div>

  <!-- Tab Content -->
  <div class="tabs-content">
    <!-- Stats Tab -->
    <div id="player-stats-tab" class="tab-content active">
      <PlayerStatsTab title={title} />
    </div>

    <!-- Strengths & Weaknesses Tab -->
    <div id="player-strengths-tab" class="tab-content">
      <StrengthsWeaknessesTab />
    </div>

    <!-- Similarity Tab -->
    <div id="player-similarity-tab" class="tab-content">
      <SimilarityTab />
    </div>
  </div>
</div>

<style>
  .player-stats-content-card {
    width: 100%;
    max-width: 600px;
    display: flex;
    flex-direction: column;
    border-radius: 0.375rem;
    overflow: hidden;
  }

  /* Tab Navigation */
  .tabs-nav {
    display: flex;
    justify-content: center;
    border-bottom: 1px solid var(--border);
    background-color: transparent;
  }

  :global(.dark) .tabs-nav {
    border-bottom-color: var(--border-dark);
  }

  .tab-btn {
    flex: 1;
    padding: 0.875rem 0.75rem;
    min-height: 48px;
    max-width: 140px;
    background: none;
    border: none;
    color: var(--text-secondary);
    font-weight: 500;
    font-size: 0.9rem;
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: color 0.15s, border-color 0.15s;
    text-align: center;
  }

  :global(.dark) .tab-btn {
    color: var(--text-secondary-dark);
  }

  .tab-btn:hover {
    color: var(--text);
  }

  :global(.dark) .tab-btn:hover {
    color: var(--text-dark);
  }

  .tab-btn.active {
    color: var(--text);
    border-bottom-color: var(--text);
  }

  :global(.dark) .tab-btn.active {
    color: var(--text-dark);
    border-bottom-color: var(--text-dark);
  }

  .tabs-content {
    min-height: 300px;
  }

  .tab-content {
    display: none;
  }

  .tab-content.active {
    display: block;
  }

  /* Responsive - Mobile */
  @media (max-width: 480px) {
    .tabs-nav {
      gap: 0;
    }

    .tab-btn {
      padding: 0.75rem 0.25rem;
      font-size: 0.8rem;
    }
  }

  /* Extra small screens */
  @media (max-width: 320px) {
    .tab-btn {
      font-size: 0.75rem;
      padding: 0.75rem 0.125rem;
    }
  }
</style>

<script>
  /**
   * Player Stats Content Card Tab Manager
   */
  class PlayerStatsContentCardManager {
    private card: HTMLElement;

    constructor(card: HTMLElement) {
      this.card = card;
      this.bindTabEvents();
    }

    private bindTabEvents() {
      this.card.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const target = e.currentTarget as HTMLButtonElement;
          const tab = target.dataset.tab;

          // Update active tab button
          this.card.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          target.classList.add('active');

          // Update active tab content
          this.card.querySelectorAll('.tab-content').forEach(p => p.classList.remove('active'));
          const panel = this.card.querySelector(`#${tab}-tab`);
          if (panel) panel.classList.add('active');

          // Lazy-load tab content
          if (tab === 'player-stats') {
            (window as any).playerStatsTab?.load();
          }
          if (tab === 'player-strengths') {
            (window as any).strengthsTab?.load();
          }
          if (tab === 'player-similarity') {
            (window as any).similarityTab?.load();
          }
        });
      });
    }
  }

  // Initialize on page load
  const playerStatsContentCard = document.querySelector<HTMLElement>('.player-stats-content-card');
  if (playerStatsContentCard) {
    new PlayerStatsContentCardManager(playerStatsContentCard);
  }
</script>
