---
// Pure Astro sport selector - zero React
interface Props {
  initialSport?: string;
}

const { initialSport = 'nba' } = Astro.props;

const sports = [
  { id: 'nba', display: 'NBA' },
  { id: 'nfl', display: 'NFL' },
  { id: 'football', display: 'Football' },
];
---

<nav id="sport-selector" class="flex gap-2 flex-wrap" data-initial={initialSport}>
  {sports.map((sport) => (
    <button
      data-sport={sport.id}
      class={`btn sport-btn ${initialSport === sport.id ? 'btn-primary' : 'btn-secondary'}`}
    >
      {sport.display}
    </button>
  ))}
</nav>

<script>
  const STORAGE_KEY = 'activeSport';

  class SportSelector {
    private container: HTMLElement;
    private buttons: NodeListOf<HTMLButtonElement>;
    private currentSport: string;

    constructor() {
      this.container = document.getElementById('sport-selector')!;
      this.buttons = this.container.querySelectorAll('.sport-btn');
      
      // Load from localStorage or use initial
      const stored = localStorage.getItem(STORAGE_KEY);
      const initial = this.container.dataset.initial || 'nba';
      this.currentSport = stored || initial;

      this.init();
    }

    private init() {
      this.updateButtons();
      this.bindEvents();
      
      // Dispatch initial event for other components
      this.dispatchChange();
    }

    private bindEvents() {
      this.buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          const sport = btn.dataset.sport!;
          this.selectSport(sport);
        });
      });
    }

    private selectSport(sport: string) {
      this.currentSport = sport;
      localStorage.setItem(STORAGE_KEY, sport);
      this.updateButtons();
      this.dispatchChange();
    }

    private updateButtons() {
      this.buttons.forEach(btn => {
        const isActive = btn.dataset.sport === this.currentSport;
        btn.classList.toggle('btn-primary', isActive);
        btn.classList.toggle('btn-secondary', !isActive);
      });
    }

    private dispatchChange() {
      // Custom event for other components to listen to
      window.dispatchEvent(new CustomEvent('sportchange', { 
        detail: { sport: this.currentSport } 
      }));
    }
  }

  // Initialize
  new SportSelector();
</script>
