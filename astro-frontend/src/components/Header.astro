---
// Header with hamburger menu - contains theme toggle and navigation
// Hamburger (left) | Logo (center) | Theme toggle (right)
---

<header class="header-wrapper sticky top-0 z-50 bg-[#f8f6f1]/95 dark:bg-[#1e1e1e]/95 backdrop-blur-sm border-b border-[#e8e4db] dark:border-[#3e3e3e]">
  <div class="header-content relative flex items-center justify-center h-14 w-full">
    <!-- Left: Hamburger Menu Button (absolute left edge) -->
    <button
      id="menu-toggle"
      class="header-btn hamburger-btn absolute left-2 p-1.5 rounded-md transition-all"
      aria-label="Toggle menu"
      aria-expanded="false"
    >
      <svg id="menu-icon" class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
      <svg id="close-icon" class="w-7 h-7 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    <!-- Center: Logo (centered in viewport) -->
    <a href="/" class="header-logo flex items-center transition-all" aria-label="Go to home">
      <img src="/new logo.png" alt="Scoracle" class="h-12 w-auto" />
    </a>

    <!-- Right: Theme Toggle Switch (absolute right edge) -->
    <div class="theme-switch-wrapper absolute right-2 flex items-center gap-2">
      <svg id="sun-icon-inline" class="w-5 h-5 text-[#d4a574] dark:text-gray-500" fill="currentColor" viewBox="0 0 24 24">
        <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
      </svg>
      <button
        id="theme-toggle"
        class="theme-toggle-switch relative inline-flex h-8 w-14 items-center rounded-full border border-[#d9cfc2] dark:border-[#444] bg-[#f5f1e8] dark:bg-[#2c2c2c] transition-colors focus:outline-none focus:ring-0"
        aria-label="Toggle dark mode"
        role="switch"
        aria-checked="false"
      >
        <span id="toggle-circle" class="inline-block h-6 w-6 transform rounded-full bg-white dark:bg-[#61afef] shadow-lg transition-transform"></span>
      </button>
      <svg id="moon-icon-inline" class="w-5 h-5 text-gray-400 dark:text-[#8b7ba8]" fill="currentColor" viewBox="0 0 24 24">
        <path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
      </svg>
    </div>
  </div>

  <!-- Dropdown Menu -->
  <div id="menu-dropdown" class="menu-dropdown hidden border-t border-[#e8e4db] dark:border-[#3e3e3e] bg-[#f8f6f1] dark:bg-[#2c2c2c]">
    <div class="menu-content py-4 px-4 space-y-4">
      <!-- Navigation Links -->
      <nav class="space-y-2">
        <a href="/" class="menu-link block px-4 py-2 rounded-lg transition-all">
          Home
        </a>
      </nav>

      <!-- Divider -->
      <hr class="border-[#e8e4db] dark:border-[#3e3e3e]" />

      <!-- Language Selector -->
      <div>
        <p class="text-sm font-medium text-[#7a7a7a] dark:text-[#888888] mb-3 px-4">Language</p>
        <div class="px-4">
          <select id="language-select" class="w-full px-3 py-2 rounded-lg border border-[#e8e4db] dark:border-[#3e3e3e] bg-[#f5f1e8] dark:bg-[#1e1e1e] text-[#3d3d3d] dark:text-[#e8e8e8] focus:outline-none focus:ring-2 focus:ring-[#8b7ba8] dark:focus:ring-[#61afef] transition-all">
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="fr">Français</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</header>

<style scoped>
  .header-wrapper {
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  :global(.dark) .header-wrapper {
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
  }

  .header-content {
    position: relative;
    width: 100%;
  }

  .header-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    color: #7a7a7a;
    background-color: transparent;
    outline: none;
    border: none;
  }

  .header-btn:focus,
  .header-btn:focus-visible {
    outline: none;
    box-shadow: none;
  }

  :global(.dark) .header-btn {
    color: #b0b0b0;
  }

  .header-btn:hover {
    background-color: rgba(212, 165, 116, 0.15);
    color: #8b7355;
  }

  :global(.dark) .header-btn:hover {
    background-color: rgba(176, 176, 176, 0.15);
    color: #d0d0d0;
  }

  .header-logo {
    color: #8b7ba8;
    background: linear-gradient(135deg, #8b7ba8 0%, #d4a574 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .theme-switch-wrapper {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .theme-toggle-switch {
    cursor: pointer;
    position: relative;
  }

  #toggle-circle {
    position: absolute;
    left: 0.25rem;
  }

  :global(.dark) #toggle-circle {
    transform: translateX(24px);
  }

  :global(.dark) .header-logo {
    background: linear-gradient(135deg, #61afef 0%, #c678dd 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .header-logo:hover {
    opacity: 0.8;
    transform: translateY(-2px);
  }

  .menu-dropdown {
    animation: slideDown 0.2s ease;
  }

  .menu-dropdown:not(.hidden) {
    animation: slideDown 0.2s ease;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .menu-link {
    color: #3d3d3d;
  }

  :global(.dark) .menu-link {
    color: #d0d0d0;
  }

  .menu-link:hover {
    background-color: rgba(38, 139, 210, 0.08);
    color: #268bd2;
  }

  :global(.dark) .menu-link:hover {
    background-color: rgba(97, 175, 239, 0.15);
    color: #61afef;
  }

  #language-select {
    font-size: 0.875rem;
  }

  #language-select option {
    background-color: #2c2c2c;
    color: #e8e8e8;
  }
</style>

<script>
  const STORAGE_KEY = 'color-scheme';
  const LANG_STORAGE_KEY = 'preferred-language';

  class HeaderManager {
    private menuToggle: HTMLButtonElement;
    private menuDropdown: HTMLElement;
    private themeToggle: HTMLButtonElement;
    private menuIcon: HTMLElement;
    private closeIcon: HTMLElement;
    private toggleCircle: HTMLElement;
    private languageSelect: HTMLSelectElement;
    private isMenuOpen = false;

    constructor() {
      this.menuToggle = document.getElementById('menu-toggle') as HTMLButtonElement;
      this.menuDropdown = document.getElementById('menu-dropdown') as HTMLElement;
      this.themeToggle = document.getElementById('theme-toggle') as HTMLButtonElement;
      this.menuIcon = document.getElementById('menu-icon') as HTMLElement;
      this.closeIcon = document.getElementById('close-icon') as HTMLElement;
      this.toggleCircle = document.getElementById('toggle-circle') as HTMLElement;
      this.languageSelect = document.getElementById('language-select') as HTMLSelectElement;

      this.init();
    }

    private init() {
      // Menu toggle
      this.menuToggle.addEventListener('click', () => this.toggleMenu());

      // Theme toggle switch
      this.themeToggle.addEventListener('click', () => this.toggleTheme());

      // Language select
      if (this.languageSelect) {
        this.languageSelect.addEventListener('change', (e) => {
          localStorage.setItem(LANG_STORAGE_KEY, (e.target as HTMLSelectElement).value);
        });
      }

      // Close menu on outside click
      document.addEventListener('click', (e) => {
        if (this.isMenuOpen && 
            !this.menuToggle.contains(e.target as Node) && 
            !this.menuDropdown.contains(e.target as Node)) {
          this.closeMenu();
        }
      });

      // Close on escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.isMenuOpen) {
          this.closeMenu();
        }
      });

      this.updateThemeUI();
    }

    private toggleMenu() {
      this.isMenuOpen ? this.closeMenu() : this.openMenu();
    }

    private openMenu() {
      this.isMenuOpen = true;
      this.menuDropdown.classList.remove('hidden');
      this.menuIcon.classList.add('hidden');
      this.closeIcon.classList.remove('hidden');
      this.menuToggle.setAttribute('aria-expanded', 'true');
    }

    private closeMenu() {
      this.isMenuOpen = false;
      this.menuDropdown.classList.add('hidden');
      this.menuIcon.classList.remove('hidden');
      this.closeIcon.classList.add('hidden');
      this.menuToggle.setAttribute('aria-expanded', 'false');
    }

    private toggleTheme() {
      const isDark = document.documentElement.classList.contains('dark');
      const newTheme = isDark ? 'light' : 'dark';
      this.setTheme(newTheme);
    }

    private setTheme(theme: string) {
      localStorage.setItem(STORAGE_KEY, theme);
      document.documentElement.classList.toggle('dark', theme === 'dark');
      this.updateThemeUI();
    }

    private updateThemeUI() {
      const isDark = document.documentElement.classList.contains('dark');
      this.themeToggle.setAttribute('aria-checked', isDark.toString());
    }
  }

  new HeaderManager();
</script>
