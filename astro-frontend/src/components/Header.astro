---
// Header with hamburger menu - contains theme toggle and navigation
// Hamburger (left) | Logo (center) | Theme toggle (right)
---

<header class="header-wrapper">
  <div class="header-content">
    <!-- Left: Hamburger Menu Button (absolute left edge) -->
    <button
      id="menu-toggle"
      class="header-btn hamburger-btn"
      aria-label="Toggle menu"
      aria-expanded="false"
    >
      <svg id="menu-icon" class="icon-large" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
      <svg id="close-icon" class="icon-large hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    <!-- Center: Logo (centered in viewport) -->
    <a href="/" class="header-logo" aria-label="Go to home">
      <img src="/new logo.png" alt="Scoracle" class="logo-img" />
    </a>

    <!-- Right: Theme Toggle Switch (absolute right edge) -->
    <div class="theme-switch-wrapper">
      <svg id="sun-icon-inline" class="icon-medium sun-icon" fill="currentColor" viewBox="0 0 24 24">
        <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
      </svg>
      <button
        id="theme-toggle"
        class="theme-toggle-switch"
        aria-label="Toggle dark mode"
        role="switch"
        aria-checked="false"
      >
        <span id="toggle-circle" class="toggle-circle"></span>
      </button>
      <svg id="moon-icon-inline" class="icon-medium moon-icon" fill="currentColor" viewBox="0 0 24 24">
        <path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
      </svg>
    </div>
  </div>

  <!-- Dropdown Menu -->
  <div id="menu-dropdown" class="menu-dropdown hidden">
    <div class="menu-content">
      <!-- Navigation Links -->
      <nav class="space-y-2">
        <a href="/" class="menu-link block px-4 py-2 rounded-lg transition-all">
          Home
        </a>
      </nav>

      <!-- Divider -->
      <hr class="border-[#e8e4db] dark:border-[#3e3e3e]" />

      <!-- Language Selector -->
      <div>
        <p class="text-sm font-medium text-[#7a7a7a] dark:text-[#888888] mb-3 px-4">Language</p>
        <div class="px-4">
          <select id="language-select" class="w-full px-3 py-2 rounded-lg border border-[#e8e4db] dark:border-[#3e3e3e] bg-[#f5f1e8] dark:bg-[#1e1e1e] text-[#3d3d3d] dark:text-[#e8e8e8] focus:outline-none focus:ring-2 focus:ring-[#8b7ba8] dark:focus:ring-[#61afef] transition-all">
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="fr">Français</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</header>

<style scoped>
  .hidden {
    display: none;
  }

  .header-wrapper {
    position: sticky;
    top: 0;
    z-index: 50;
    background-color: rgba(248, 246, 241, 0.95);
    border-bottom: 1px solid #e8e4db;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    backdrop-filter: blur(4px);
  }

  :global(.dark) .header-wrapper {
    background-color: rgba(30, 30, 30, 0.95);
    border-bottom-color: #3e3e3e;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
  }

  .header-content {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 3.5rem;
  }

  .header-btn {
    position: absolute;
    left: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.375rem;
    color: #7a7a7a;
    background-color: transparent;
    outline: none;
    border: none;
    border-radius: 0.375rem;
    transition: all 0.2s ease;
    cursor: pointer;
  }

  .header-btn:focus,
  .header-btn:focus-visible {
    outline: none;
    box-shadow: none;
  }

  :global(.dark) .header-btn {
    color: #b0b0b0;
  }

  .header-btn:hover {
    background-color: rgba(212, 165, 116, 0.15);
    color: #8b7355;
  }

  :global(.dark) .header-btn:hover {
    background-color: rgba(176, 176, 176, 0.15);
    color: #d0d0d0;
  }

  .icon-large {
    width: 1.75rem;
    height: 1.75rem;
  }

  .header-logo {
    display: flex;
    align-items: center;
    color: #8b7ba8;
    background: linear-gradient(135deg, #8b7ba8 0%, #d4a574 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    transition: all 0.2s ease;
    cursor: pointer;
  }

  .logo-img {
    height: 3rem;
    width: auto;
  }

  .theme-switch-wrapper {
    position: absolute;
    right: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .icon-medium {
    width: 1.25rem;
    height: 1.25rem;
  }

  .sun-icon {
    color: #d4a574;
  }

  :global(.dark) .sun-icon {
    color: #7a7a7a;
  }

  .moon-icon {
    color: #999999;
  }

  :global(.dark) .moon-icon {
    color: #8b7ba8;
  }

  .theme-toggle-switch {
    cursor: pointer;
    position: relative;
    display: inline-flex;
    align-items: center;
    height: 2rem;
    width: 3.5rem;
    border-radius: 9999px;
    border: 1px solid #d9cfc2;
    background-color: #f5f1e8;
    transition: all 0.2s ease;
    outline: none;
  }

  :global(.dark) .theme-toggle-switch {
    border-color: #444;
    background-color: #2c2c2c;
  }

  .toggle-circle {
    position: absolute;
    left: 0.25rem;
    display: inline-block;
    height: 1.5rem;
    width: 1.5rem;
    border-radius: 9999px;
    background-color: white;
    box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s ease;
  }

  :global(.dark) .toggle-circle {
    background-color: #d4a574;
    transform: translateX(24px);
  }

  :global(.dark) .header-logo {
    background: linear-gradient(135deg, #61afef 0%, #c678dd 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .header-logo:hover {
    opacity: 0.8;
    transform: translateY(-2px);
  }

  .menu-dropdown {
    position: fixed;
    top: 3.5rem;
    left: 0;
    width: 250px;
    max-height: calc(100vh - 3.5rem);
    overflow-y: auto;
    background-color: #f8f6f1;
    animation: slideInLeft 0.2s ease;
    z-index: 40;
  }

  :global(.dark) .menu-dropdown {
    background-color: #2c2c2c;
  }

  .menu-dropdown.hidden {
    display: none;
  }

  .menu-dropdown:not(.hidden) {
    animation: slideInLeft 0.2s ease;
  }

  @keyframes slideInLeft {
    from {
      opacity: 0;
      transform: translateX(-250px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .menu-content {
    padding: 1.5rem 1rem;
  }

  .menu-content > * + * {
    margin-top: 1rem;
  }

  .menu-link {
    display: block;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    transition: all 0.2s ease;
    color: #3d3d3d;
  }

  :global(.dark) .menu-link {
    color: #d0d0d0;
  }

  .menu-link:hover {
    background-color: rgba(212, 165, 116, 0.15);
    color: #8b7355;
  }

  :global(.dark) .menu-link:hover {
    background-color: rgba(212, 165, 116, 0.15);
    color: #d4a574;
  }

  #language-select {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border-radius: 0.5rem;
    border: 1px solid #e8e4db;
    background-color: #f5f1e8;
    color: #3d3d3d;
    font-size: 0.875rem;
    color-scheme: light dark;
    accent-color: #d4a574;
    outline: none;
    transition: all 0.2s ease;
  }

  :global(.dark) #language-select {
    border-color: #3e3e3e;
    background-color: #1e1e1e;
    color: #e8e8e8;
  }

  #language-select:focus {
    border-color: #d4a574;
    box-shadow: 0 0 0 2px rgba(212, 165, 116, 0.2);
  }

  #language-select option {
    background-color: #2c2c2c;
    color: #e8e8e8;
    padding: 0.25rem 0.5rem;
  }

  #language-select option:checked {
    background: linear-gradient(#d4a574, #d4a574);
    color: #1e1e1e;
  }

  #language-select option:hover {
    background: #3e3e3e;
    color: #e8e8e8;
  }
</style>

<script>
  const STORAGE_KEY = 'color-scheme';
  const LANG_STORAGE_KEY = 'preferred-language';

  class HeaderManager {
    private menuToggle: HTMLButtonElement;
    private menuDropdown: HTMLElement;
    private themeToggle: HTMLButtonElement;
    private menuIcon: HTMLElement;
    private closeIcon: HTMLElement;
    private toggleCircle: HTMLElement;
    private languageSelect: HTMLSelectElement;
    private isMenuOpen = false;

    constructor() {
      this.menuToggle = document.getElementById('menu-toggle') as HTMLButtonElement;
      this.menuDropdown = document.getElementById('menu-dropdown') as HTMLElement;
      this.themeToggle = document.getElementById('theme-toggle') as HTMLButtonElement;
      this.menuIcon = document.getElementById('menu-icon') as HTMLElement;
      this.closeIcon = document.getElementById('close-icon') as HTMLElement;
      this.toggleCircle = document.getElementById('toggle-circle') as HTMLElement;
      this.languageSelect = document.getElementById('language-select') as HTMLSelectElement;

      this.init();
    }

    private init() {
      // Menu toggle
      this.menuToggle.addEventListener('click', () => this.toggleMenu());

      // Theme toggle switch
      this.themeToggle.addEventListener('click', () => this.toggleTheme());

      // Language select
      if (this.languageSelect) {
        this.languageSelect.addEventListener('change', (e) => {
          localStorage.setItem(LANG_STORAGE_KEY, (e.target as HTMLSelectElement).value);
        });
      }

      // Close menu on outside click
      document.addEventListener('click', (e) => {
        if (this.isMenuOpen && 
            !this.menuToggle.contains(e.target as Node) && 
            !this.menuDropdown.contains(e.target as Node)) {
          this.closeMenu();
        }
      });

      // Close on escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.isMenuOpen) {
          this.closeMenu();
        }
      });

      this.updateThemeUI();
    }

    private toggleMenu() {
      this.isMenuOpen ? this.closeMenu() : this.openMenu();
    }

    private openMenu() {
      this.isMenuOpen = true;
      this.menuDropdown.classList.remove('hidden');
      this.menuIcon.classList.add('hidden');
      this.closeIcon.classList.remove('hidden');
      this.menuToggle.setAttribute('aria-expanded', 'true');
    }

    private closeMenu() {
      this.isMenuOpen = false;
      this.menuDropdown.classList.add('hidden');
      this.menuIcon.classList.remove('hidden');
      this.closeIcon.classList.add('hidden');
      this.menuToggle.setAttribute('aria-expanded', 'false');
    }

    private toggleTheme() {
      const isDark = document.documentElement.classList.contains('dark');
      const newTheme = isDark ? 'light' : 'dark';
      this.setTheme(newTheme);
    }

    private setTheme(theme: string) {
      localStorage.setItem(STORAGE_KEY, theme);
      document.documentElement.classList.toggle('dark', theme === 'dark');
      this.updateThemeUI();
    }

    private updateThemeUI() {
      const isDark = document.documentElement.classList.contains('dark');
      this.themeToggle.setAttribute('aria-checked', isDark.toString());
    }
  }

  new HeaderManager();
</script>
